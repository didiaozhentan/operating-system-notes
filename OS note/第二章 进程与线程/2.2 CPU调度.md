# 2.2.1调度的概念

概念：CPU 调度是对 CPU 进行分配，即从就绪队列中按照一定的算法(公平、高效的原则)选择一个进程并将 CPU 分配给它运行，以实现进程并发地执行。

原因：在多道程序系统中，进程的数量多于 CPU 的个数，会有进程争用 CPU 的情况。

一个作业从提交开始到完成的三次调度：
- 高级/作业调度：按规则给后备队列的作业中挑选几个分配内存、资源，并建立相应进程。是内存和辅存之间的调度，每个作业只能调入一次，调出一次。*（开始）*
- 中级/内存调度：目的是提高内存利用率和系统吞吐量。即各种条件允许时，讲挂起进程调入内存改为就绪态。实质上是存储器管理中的兑换功能。*（优化）*
- 低级/进程调度：从就绪队列中挑一个进程，将CPU分配给它。该调度的频率很高。*（允许）*
![[Pasted image 20250411102420.png]]

三种调度的联系：
- 作业调度为进程活动做准备，进程调度使进程正常活动起来。
- 中级调度将暂时不能运行的进程挂起，中级调度处于作业调度和进程调度之间。
- 作业调度次数少，中级调度次数略多，进程调度频率最高。
- 进程调度是最基本的，不可或缺。

# 2.2.2调度的实现
## 调度程序
调度程序是用于调度和分派CPU的组件，由以下三部分组成：
- 排队器
- 分派器
- 上下文切换器
在上下文切换时，需要执行大量store和load的指令来保存寄存器内容，现通常采用两组寄存器，一组供内核使用，一组供用户使用。
![[Pasted image 20250411103705.png]]

## 调度的时机/切换/过程
### 什么时候需要进程调度：
- 主动放弃（进程正常终止、运行过程中发生异常而终止、进程主动请求阻塞）
- 被动放弃（分给进程的时间片用完、有更紧急的事需要处理、有更高优先级的进程进入就绪队列）

### 什么时候不能进行进程调度？
- 在处理中断的过程中
- 在操作系统内核程序临界区中
	- 临界资源：一个时段段内各进程互斥地访问临界资源
	- 临界区：访问临界资源的那段代码
	- 内核程序临界区会访问就绪队列，导致其上锁
- 在原子操作过程中（原语）

### 进程调度的方式
非剥夺调度方式（非抢占式）：只允许进程主动放弃处理机 *（慢慢等）*

剥夺调度方式（抢占式）：进程被动放弃，可以优先处理紧急任务，适合分时操作系统、实时操作系统 *（直接插队）*