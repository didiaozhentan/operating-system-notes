# 4.1.1 文件的基本概念
## 文件(File)：
是以硬盘为载体的存储在计算机上的信息集合，文件可以是文本文档、图片、程序等。
在系统运行时，计算机以*进程*为基本单位进行资源的调度和分配；
而在用户进行的输入输出中，则以*文件*为基本单位。
## 文件的定义：
文件的结构分为
1. 数据项。是文件系统中最低级的数据组织形式，可分为以下两种类型:·
	- 基本数据项。用于描述一个对象的某种属性的一个值，是数据中的最小逻辑单位。
	- 组合数据项。由多个基本数据项组成。
2. 记录。是一组相关的数据项的集合，用于描述一个对象在某方面的属性。
3. 文件。是指由创建者所定义的、具有文件名的一组相关元素的集合，可分为*有结构文件和无结构文件*两种。在有结构文件中，文件由若干个相似的记录组成，如一个班的学生记录;而无结构文件则被视为一个字符流，比如一个二进制文件或字符文件。

## 文件的属性
1. 名称。文件名称唯一，以容易读取的形式保存。
2. 类型。被支持不同类型的文件系统所使用。
3. 创建者。文件创建者的 ID。
4. 所有者。文件当前所有者的 ID。
5. 位置。指向设备和设备上文件的指针。
6. 大小。文件当前大小(用字节、字或块表示)，也可包含文件允许的最大值。
7. 保护。对文件进行保护的访问控制信息。
8. 创建时间。最后一次修改时间和最后一次存取时间。文件创建、上次修改和上次访问的相关信息，用于保护和跟踪文件的使用。

## 文件的分类
1. 按性质和用途分类，分为系统文件、用户文件、库文件。
2. 按文件中数据的形式分类，分为源文件、目标文件、可执行文件。
3. 按存取控制属性分类，分为可执行文件、只读文件、读/写文件。
4. 按组织形式和处理方式分类，分为普通文件、目录文件、特殊文件

# 4.1.2 文件控制块和索引节点
文件控制块(File Control Block，FCB)是用来存放控制文件需要的各种信息的数据结构,
![[Pasted image 20250511153526.png]]
FCB 主要包含以下信息：
- 基本信息，如文件名、文件的物理位置、文件的逻辑结构、文件的物理结构等。
- 存取控制信息，包括文件主的存取权限、核准用户的存取权限以及一般用户的存取权限。
- 使用信息，如文件建立时间、上次修改时间等。
# 4.1.2 文件的逻辑结构

1、无结构文件

文件由一系列二进制文件流组成

2、有结构文件（记录式文件）

顺序文件：文件中的记录一个接一个顺序排列，定长或变长，可以顺序存储或者链式存储

按照是否与关键字顺序有关，可以分为串结构和顺序结构

链式：无法随机存取

顺序存储：

- 可变长：无法随机存取
- 定长：可以随机存取，采用串结构，无法快速找到关键字；采用顺序结构，可以快速查找关键字

索引文件：索引表本身是定长的顺序文件

索引顺序文件：多级索引表嵌套查找

# 4.1.3 文件目录

1、文件控制块（FCB）

搜索、创建文件、删除文件、显示目录、修改目录

2、目录结构

- 单级目录结构
- 两级目录结构

主文件目录（MFD）+用户文件目录（UFD）

- 多级目录结构（树形目录结构）

当代操作系统采用方法、不便于文件共享

- 无环图目录结构
- 可以共享

3、索引节点（对文件控制块

压缩文件名和信息

# 4.1.4 文件的物理结构（文件分配方式）

1、对非空闲磁盘块的管理

连续分配：连续分配方式要求每个文件在磁盘上占有一组连续的块，对文件的拓展不方便，有很多磁盘碎片

链接分配

- 隐式分配：采用链接分配方式的文件，只支持顺序访问，不支持随机访问，方便拓展
- 显示分配：文件分配表显式记录下一块物理块的位置，方便拓展，支持随机访问，文件表会占内存空间

# 4.1.4 文件的物理结构（文件分配方式）

索引分配

索引分配允许文件离散地分配在各个磁盘块中，系统会为每个文件建立一张索引表，索引表记录了文件的各个逻辑块对应的物理块

支持随机访问

- 链接方案
- 多层索引
- 混合索引

# 4.1.5 文件存储空间管理

1、存储空间的划分与初始化

- 文件卷（逻辑卷）的概念
- 目录区与文件区

2、几种管理方法

- 空闲表法：首位置+长度，回收时注意修改
- 空闲链表法（空闲盘块链、空闲盘区链）
- 位示图法
- 成组链接法：文件卷的目录区中专门用一个磁盘块作为超级块，当系统启动时需要将超级内存块读入内存。并且保证内存与外存中的超级块数据一致。

4.1.6 文件的基本操作

创建文件（create）

1、在外存中找到文件所需的空间

2、创建该文件对应的目录项

删除文件(delete)

1、找到文件名对应的目录项

2、回收文件占用的磁盘块

3、删除文件对应的目录项

读文件(read)

写文件(write)

打开文件(open)

1、找到文件名对应的目录项

2、将目录项复制到内存中的“打开文件”中

关闭文件(close)

4.1.7 文件共享

1、基于索引结点的共享方式（硬链接）

直接指向文件的索引节点

2、基于符号链的共享方式（软链接）

相当于win的快捷方式

4.1.8 文件保护

1、口令保护

2、加密保护

保密性强，不需要在系统中存储“密码”

编码/译码，需要花费一定时间

3、访问控制

在每个文件的FCB中增加一个访问控制表（ACL），该表记录了各个用户可以对该文件执行哪些操作

4.1.9 文件系统的层次结构

用户/应用接口

用户接口

文件目录系统

存取控制模块

逻辑文件系统与文件信息缓冲区

物理文件系统

辅助分配模块 设备管理模块